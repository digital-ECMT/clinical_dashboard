---
title: "Create synthetic data for clinical dashboard"
author: "dECMT"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
require(dplyr)
# rm(list=ls())
```


```{r global parameters}
datetime_format <- "%Y-%m-%d %H:%M:%S"
dateformat <- "%Y-%m-%d"
timeformat <- "%H:%M:%S"
number_synthetic_patients <- 100

```

```{r synthetic demographics}

demographics_synth <- data.frame(SUBJECT_ID	= character(0),
                                 VARIABLE_NAME	= character(0),
                                 VARIABLE_VALUE = character(0), 
                                 stringsAsFactors=FALSE)






for(i in 1:number_synthetic_patients) {
  # generate patient ID
  subject_id <- paste0("patient_", i)
  # generate dob
  value <- sample(seq(as.Date('1945/01/01'), as.Date('2000/01/01'), by="day"), 1)
  demographics_synth <- demographics_synth %>%
    add_row(
      SUBJECT_ID = subject_id, 
      VARIABLE_NAME = "DOB", 
      VARIABLE_VALUE = as.character(value)
    )
  # generate gender
    value <- sample(c("MALE", "FEMALE"), 1)
    demographics_synth <- demographics_synth %>%
      add_row(
        SUBJECT_ID = subject_id, 
        VARIABLE_NAME = "GENDER", 
        VARIABLE_VALUE = as.character(value)
      )
  # generate ethnic group
    value <- sample(c("A", "B", "C"), 1)
    demographics_synth <- demographics_synth %>%
      add_row(
        SUBJECT_ID = subject_id, 
        VARIABLE_NAME = "ETHNIC_GROUP", 
        VARIABLE_VALUE = as.character(value)
      )    
  # generate smoking status
    value <- sample(c("Never smoked", "Smoker", "Former smoker", NA), 1)
    demographics_synth <- demographics_synth %>%
      add_row(
        SUBJECT_ID = subject_id, 
        VARIABLE_NAME = "SMOKING", 
        VARIABLE_VALUE = as.character(value)
      )    
  # generate height
    value <- round(rnorm(n=1, mean=170, sd=15), digits = 0)
    demographics_synth <- demographics_synth %>%
      add_row(
        SUBJECT_ID = subject_id, 
        VARIABLE_NAME = "HEIGHT", 
        VARIABLE_VALUE = as.character(value)
      )   
  # generate weight
    value <- round(rnorm(n=1, mean=70, sd=5), digits = 0)
    demographics_synth <- demographics_synth %>%
      add_row(
        SUBJECT_ID = subject_id, 
        VARIABLE_NAME = "WEIGHT", 
        VARIABLE_VALUE = as.character(value)
      ) 
  
}  
  
  

```

```{r get subject IDs}
## get subject IDs
subject_ids <- unique(demographics_synth$SUBJECT_ID)
```

```{r synthetic events}

# Create sequence of dates
# datetime_sequence <- seq(as.POSIXct('2022/01/01'),  
#                          as.POSIXct('2022/11/01'),
#                          by = "10 mins")

events_synth <- data.frame(SUBJECT_ID	= character(0),
                                 EVENT_NAME	= character(0),
                                 EVENT_DATETIME = character(0), 
                                 stringsAsFactors=FALSE)


for(i in 1:length(subject_ids)) {
  # generate patient ID
  subject_id <- subject_ids[i]
  # generate admission events on random dates
  datetime <- sample(x= seq(as.POSIXct('2022/01/01'),as.POSIXct('2022/02/01'),by = "10 mins"), size = 1 )
  events_synth <- events_synth %>%
    add_row(
      SUBJECT_ID = subject_id, 
      EVENT_NAME = "ADMISSION", 
      EVENT_DATETIME = as.character(datetime)
    )
  # generate ITU events
  datetime <- sample(x= seq(as.POSIXct('2022/02/01'),as.POSIXct('2022/03/01'),by = "10 mins"), size = 1 )
  ## randomly decide not to have any ITU events
  random <- rbinom(n=1, size=1, prob = c(0.5,0.5))
  ## only create an event if random is 1
  if(random == 1) {
    events_synth <- events_synth %>%
    add_row(
      SUBJECT_ID = subject_id, 
      EVENT_NAME = "ITU", 
      EVENT_DATETIME = as.character(datetime)
    )
  } 
  
  # generate treatment start events
  datetime <- sample(x= seq(as.POSIXct('2022/03/01'),as.POSIXct('2022/04/01'),by = "10 mins"), size = 1 )
  events_synth <- events_synth %>%
    add_row(
      SUBJECT_ID = subject_id, 
      EVENT_NAME = "TREATMENT_START", 
      EVENT_DATETIME = as.character(datetime)
    )
  # generate treatment end events
  datetime <- sample(x= seq(as.POSIXct('2022/04/01'),as.POSIXct('2022/05/01'),by = "10 mins"), size = 1 )
  events_synth <- events_synth %>%
    add_row(
      SUBJECT_ID = subject_id, 
      EVENT_NAME = "TREATMENT_END", 
      EVENT_DATETIME = as.character(datetime)
    )
  # generate X ray events
  datetime <- sample(x= seq(as.POSIXct('2022/05/01'),as.POSIXct('2022/06/01'),by = "10 mins"), size = 1 )
  events_synth <- events_synth %>%
    add_row(
      SUBJECT_ID = subject_id, 
      EVENT_NAME = "X_RAY", 
      EVENT_DATETIME = as.character(datetime)
    )
  
}  
  
  

```

```{r synthetic measurements}
measurements_synth <- data.frame(SUBJECT_ID = character(0),
                           MEASUREMENT_NAME = character(0),
                           MEASUREMENT_DATETIME = character(0),
                           MEASUREMENT_VALUE = character(0),
                           UNIT = character(0),
                           stringsAsFactors=FALSE)


for(i in 1:length(subject_ids)) {
  # generate patient ID
  subject_id <- subject_ids[i]
  # get datetime of first event for this patient
  earliest_datetime <- min(events$EVENT_DATETIME[events$SUBJECT_ID == subject_id])
  # get datetime of last event for this patient
  latest_datetime <- max(events$EVENT_DATETIME[events$SUBJECT_ID == subject_id])
  # get date range
  inpatient_dates <- seq(from = earliest_datetime,to = latest_datetime,by = "day")
  for(j in 1:length(inpatient_dates)) {
    datetime <- inpatient_dates[j]
    # specify measurement
    measurement <- "UREA"
    # specify unit
    unit <- "mmol/L"
    # generate a value
    value <- round(rnorm(n=1, mean = 8, sd = 1), digits = 1)
    measurements_synth <- measurements_synth %>%
      add_row(
        SUBJECT_ID = subject_id, 
        MEASUREMENT_NAME = measurement, 
        MEASUREMENT_DATETIME = as.character(datetime),
        MEASUREMENT_VALUE = as.character(value), 
        UNIT = unit
      )
    
  }
  
  
  
  
  
  
  
  
  
}



```
















```{r write synthetic data to csv}

write.csv(x=demographics_synth, file = "DEMOGRAPHICS.csv", row.names = FALSE)
write.csv(x=events_synth, file = "EVENTS.csv", row.names = FALSE)
write.csv(x=measurements_synth, file = "MEASUREMENTS.csv", row.names = FALSE)
# write.csv(x=Vitalsigns_Numeric_synth, file = "REACT_Vitalsigns_Numeric.csv", row.names = FALSE)
# write.csv(x=Vitalsigns_Cat_synth, file = "REACT_Vitalsigns_Categorical.csv", row.names = FALSE)
# write.csv(x=labresults_synth, file = "REACT_LabResults.csv", row.names = FALSE)


```
